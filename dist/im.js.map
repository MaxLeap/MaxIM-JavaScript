{"version":3,"sources":["../src/im.ts"],"names":[],"mappings":";;IAsCA;QAKE,mBAAY,OAAqB;YAC/B,EAAE,CAAC,CAAC,CAAC,OAAO,IAAI,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC;gBAC7C,MAAM,IAAI,KAAK,CAAC,sBAAoB,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,MAAG,CAAC,CAAC;YAClE,CAAC;YACD,IAAI,MAAc,CAAC;YACnB,IAAM,QAAQ,GAAW,OAAO,CAAC,OAAO,GAAG,SAAS,GAAG,UAAU,CAAC;YAClE,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,IAAI,IAAI,CAAC,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;gBAC/C,KAAK,IAAI;oBACP,MAAM,GAAG,gBAAgB,CAAC;oBAC1B,KAAK,CAAC;gBACR,KAAK,IAAI;oBACP,MAAM,GAAG,eAAe,CAAC;oBACzB,KAAK,CAAC;gBACR,KAAK,MAAM;oBACT,MAAM,GAAG,kBAAkB,CAAC;oBAC5B,KAAK,CAAC;gBACR;oBACE,MAAM,IAAI,KAAK,CAAC,oBAAkB,OAAO,CAAC,MAAM,MAAG,CAAC,CAAC;YACzD,CAAC;YACD,IAAI,CAAC,cAAc,GAAG,IAAI,mBAAU,CAAC,KAAG,QAAQ,GAAG,MAAQ,EAAE,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC;YACvF,IAAI,CAAC,YAAY,GAAG,IAAI,iBAAS,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QACzD,CAAC;QAEM,yBAAK,GAAZ;YACE,MAAM,CAAC,IAAI,iBAAS,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAC5C,CAAC;QAEM,6BAAS,GAAhB,UAAiB,EAAW;YAC1B,MAAM,CAAC,IAAI,gCAAoB,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,CAAC,CAAC;QAC3D,CAAC;QAEM,yBAAK,GAAZ;YACE,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC;QAC3B,CAAC;QACH,gBAAC;IAAD,CAvCA,AAuCC,IAAA;IAED,EAAE,CAAC,CAAC,OAAO,MAAM,KAAK,WAAW,CAAC,CAAC,CAAC;QAClC,IAAM,EAAE,GAAG,IAAI,CAAC;QAChB,IAAM,EAAE,GAAG,IAAI,CAAC;QAChB,EAAE,CAAC,CAAC,OAAO,MAAM,CAAC,EAAE,CAAC,KAAK,WAAW,CAAC,CAAC,CAAC;YACtC,MAAM,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC;QAClB,CAAC;QACD,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,GAAG,UAAC,OAAqB;YACrC,MAAM,CAAC,IAAI,SAAS,CAAC,OAAO,CAAC,CAAC;QAChC,CAAC,CAAC;IACJ,CAAC;IAED,OAAS,UAAC,OAAqB,IAAY,OAAA,IAAI,SAAS,CAAC,OAAO,CAAC,EAAtB,CAAsB,CAAC","file":"im.js","sourcesContent":["import {Login} from \"./api/login\";\nimport {AdminImpl} from \"./impl/admin/admin\";\nimport {LoginImpl} from \"./impl/login/login\";\nimport {PassengerBuilderImpl} from \"./impl/passenger/passenger\";\nimport {APIOptions} from \"./model/models\";\nimport {Admin} from \"./api/admin\";\nimport {PassengerBuilder} from \"./api/passenger\";\n\ninterface MaxIMOptions {\n  app: string;\n  key: string;\n  region?: string;\n  useHttp?: boolean;\n}\n\n/**\n * 主功能接口\n */\ninterface MaxIM {\n  /**\n   * 登录\n   * @return {Login}\n   */\n  login(): Login;\n\n  /**\n   * 访客登录\n   * @param id 访客ID\n   */\n  passenger(id?: string): PassengerBuilder;\n\n  /**\n   * 获取管理接口\n   * @return {Admin}\n   */\n  admin(): Admin;\n}\n\nclass MaxIMImpl implements MaxIM {\n\n  private currentOptions: APIOptions;\n  private currentAdmin: Admin;\n\n  constructor(options: MaxIMOptions) {\n    if (!options || !options.app || !options.key) {\n      throw new Error(`invalid options: ${JSON.stringify(options)}.`);\n    }\n    let server: string;\n    const protocol: string = options.useHttp ? \"http://\" : \"https://\";\n    switch ((options.region || \"cn\").toLowerCase()) {\n      case \"us\":\n        server = \"im.maxleap.com\";\n        break;\n      case \"cn\":\n        server = \"im.maxleap.cn\";\n        break;\n      case \"test\":\n        server = \"imuat.maxleap.cn\";\n        break;\n      default:\n        throw new Error(`invalid region ${options.region}.`);\n    }\n    this.currentOptions = new APIOptions(`${protocol}${server}`, options.app, options.key);\n    this.currentAdmin = new AdminImpl(this.currentOptions);\n  }\n\n  public login(): Login {\n    return new LoginImpl(this.currentOptions);\n  }\n\n  public passenger(id?: string): PassengerBuilder {\n    return new PassengerBuilderImpl(this.currentOptions, id);\n  }\n\n  public admin(): Admin {\n    return this.currentAdmin;\n  }\n}\n\nif (typeof window !== \"undefined\") {\n  const ml = \"ML\";\n  const im = \"im\";\n  if (typeof window[ml] === \"undefined\") {\n    window[ml] = {};\n  }\n  window[ml][im] = (options: MaxIMOptions) => {\n    return new MaxIMImpl(options);\n  };\n}\n\nexport = (options: MaxIMOptions): MaxIM => new MaxIMImpl(options);\n"]}