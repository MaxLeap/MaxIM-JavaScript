{"version":3,"sources":["../src/impl/common/buildSearch.ts"],"names":[],"mappings":";;;;;;;IAYA;QAAgC,qCAAsB;QAAtD;YAAgC,8BAAsB;QA2CtD,CAAC;QAzCQ,oCAAQ,GAAf,UAAgB,QAAkC;YAChD,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;QACtC,CAAC;QAEM,qCAAS,GAAhB,UAAiB,QAAgC;YAC/C,IAAI,CAAC,YAAY,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;QACzC,CAAC;QAEM,oCAAQ,GAAf,UAAgB,QAA+B;YAC7C,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;QACxC,CAAC;QAEO,kCAAM,GAAd,UAAe,IAAY;YACzB,IAAM,CAAC,GAAa,EAAE,CAAC;YACvB,GAAG,CAAC,CAAC,IAAM,CAAC,IAAI,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC;gBACtC,IAAM,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;gBACnC,CAAC,CAAC,IAAI,CAAI,CAAC,SAAI,CAAG,CAAC,CAAC;YACtB,CAAC;YACD,CAAC,CAAC,IAAI,CAAC,YAAS,IAAI,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC,CAAE,CAAC,CAAC;YAC7C,CAAC,CAAC,IAAI,CAAC,aAAU,IAAI,CAAC,UAAU,CAAC,KAAK,IAAI,EAAE,CAAE,CAAC,CAAC;YAChD,MAAM,CAAC,KAAG,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,IAAI,SAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAG,CAAC;QAC3D,CAAC;QAEO,wCAAY,GAApB,UAAwB,IAAY,EAAE,QAAqB;YACzD,IAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YAE9B,KAAK,CAAC,GAAG,CAAC,GAAG,EAAE,EAAC,OAAO,EAAE,IAAI,CAAC,UAAU,CAAC,OAAO,EAAC,CAAC;iBAC7C,IAAI,CAAC,UAAC,QAAQ;gBACb,MAAM,CAAC,QAAQ,CAAC,IAAS,CAAC;YAC5B,CAAC,CAAC;iBACD,IAAI,CAAC,UAAC,MAAM;gBACX,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACb,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBACzB,CAAC;YACH,CAAC,CAAC;iBACD,KAAK,CAAC,UAAC,CAAC;gBACP,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACb,QAAQ,CAAC,CAAC,CAAC,CAAC;gBACd,CAAC;YACH,CAAC,CAAC,CAAC;QACT,CAAC;QACH,wBAAC;IAAD,CA3CA,AA2CC,CA3C+B,iBAAO,GA2CtC;IAGC,yBAAiB,qBAHlB;IAIC","file":"buildSearch.js","sourcesContent":["import * as axios from \"axios\";\nimport {SearchBuilder} from \"../../api/common\";\nimport {Callback, GroupInfo, RoomInfo, UserOutline} from \"../../model/models\";\nimport {Builder} from \"./builder\";\n\ninterface SearchOptions {\n  query?: { [key: string]: any };\n  skip?: number;\n  limit?: number;\n  sort?: string[];\n}\n\nclass SearchBuilderImpl extends Builder<SearchOptions> implements SearchBuilder {\n\n  public forUsers(callback?: Callback<UserOutline[]>) {\n    this.forSomething(\"/ctx\", callback);\n  }\n\n  public forGroups(callback?: Callback<GroupInfo[]>) {\n    this.forSomething(\"/groups\", callback);\n  }\n\n  public forRooms(callback?: Callback<RoomInfo[]>) {\n    this.forSomething(\"/rooms\", callback);\n  }\n\n  private getUrl(path: string): string {\n    const q: string[] = [];\n    for (const k in this.extOptions.query) {\n      const v = this.extOptions.query[k];\n      q.push(`${k}=${v}`);\n    }\n    q.push(`_skip=${this.extOptions.skip || 0}`);\n    q.push(`_limit=${this.extOptions.limit || 20}`);\n    return `${this.apiOptions.server}${path}?${q.join(\"&\")}`;\n  }\n\n  private forSomething<T>(path: string, callback: Callback<T>) {\n    const url = this.getUrl(path);\n\n    axios.get(url, {headers: this.apiOptions.headers})\n        .then((response) => {\n          return response.data as T;\n        })\n        .then((result) => {\n          if (callback) {\n            callback(null, result);\n          }\n        })\n        .catch((e) => {\n          if (callback) {\n            callback(e);\n          }\n        });\n  }\n}\n\nexport {\n  SearchBuilderImpl,\n};\n"]}