{"version":3,"sources":["../src/impl/common/buildSearch.ts"],"names":[],"mappings":";;;;;;AAAA,IAAY,KAAK,WAAM,OAAO,CAAC,CAAA;AAG/B,wBAAsB,WAAW,CAAC,CAAA;AASlC;IAAgC,qCAAsB;IAAtD;QAAgC,8BAAsB;IA2CtD,CAAC;IAzCQ,oCAAQ,GAAf,UAAgB,QAAkC;QAChD,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IACtC,CAAC;IAEM,qCAAS,GAAhB,UAAiB,QAAgC;QAC/C,IAAI,CAAC,YAAY,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;IACzC,CAAC;IAEM,oCAAQ,GAAf,UAAgB,QAA+B;QAC7C,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;IACxC,CAAC;IAEO,kCAAM,GAAd,UAAe,IAAY;QACzB,IAAM,CAAC,GAAa,EAAE,CAAC;QACvB,GAAG,CAAC,CAAC,IAAM,CAAC,IAAI,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC;YACtC,IAAM,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YACnC,CAAC,CAAC,IAAI,CAAI,CAAC,SAAI,CAAG,CAAC,CAAC;QACtB,CAAC;QACD,CAAC,CAAC,IAAI,CAAC,YAAS,IAAI,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC,CAAE,CAAC,CAAC;QAC7C,CAAC,CAAC,IAAI,CAAC,aAAU,IAAI,CAAC,UAAU,CAAC,KAAK,IAAI,EAAE,CAAE,CAAC,CAAC;QAChD,MAAM,CAAC,KAAG,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,IAAI,SAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAG,CAAC;IAC3D,CAAC;IAEO,wCAAY,GAApB,UAAwB,IAAY,EAAE,QAAqB;QACzD,IAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAE9B,KAAK,CAAC,GAAG,CAAC,GAAG,EAAE,EAAC,OAAO,EAAE,IAAI,CAAC,UAAU,CAAC,OAAO,EAAC,CAAC;aAC7C,IAAI,CAAC,UAAC,QAAQ;YACb,MAAM,CAAC,QAAQ,CAAC,IAAS,CAAC;QAC5B,CAAC,CAAC;aACD,IAAI,CAAC,UAAC,MAAM;YACX,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACb,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;YACzB,CAAC;QACH,CAAC,CAAC;aACD,KAAK,CAAC,UAAC,CAAC;YACP,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACb,QAAQ,CAAC,CAAC,CAAC,CAAC;YACd,CAAC;QACH,CAAC,CAAC,CAAC;IACT,CAAC;IACH,wBAAC;AAAD,CA3CA,AA2CC,CA3C+B,iBAAO,GA2CtC;AAGC,yBAAiB,qBAHlB;AAIC","file":"buildSearch.js","sourcesContent":["import * as axios from \"axios\";\nimport {SearchBuilder} from \"../../api/common\";\nimport {Callback, GroupInfo, RoomInfo, UserOutline} from \"../../model/models\";\nimport {Builder} from \"./builder\";\n\ninterface SearchOptions {\n  query?: { [key: string]: any };\n  skip?: number;\n  limit?: number;\n  sort?: string[];\n}\n\nclass SearchBuilderImpl extends Builder<SearchOptions> implements SearchBuilder {\n\n  public forUsers(callback?: Callback<UserOutline[]>) {\n    this.forSomething(\"/ctx\", callback);\n  }\n\n  public forGroups(callback?: Callback<GroupInfo[]>) {\n    this.forSomething(\"/groups\", callback);\n  }\n\n  public forRooms(callback?: Callback<RoomInfo[]>) {\n    this.forSomething(\"/rooms\", callback);\n  }\n\n  private getUrl(path: string): string {\n    const q: string[] = [];\n    for (const k in this.extOptions.query) {\n      const v = this.extOptions.query[k];\n      q.push(`${k}=${v}`);\n    }\n    q.push(`_skip=${this.extOptions.skip || 0}`);\n    q.push(`_limit=${this.extOptions.limit || 20}`);\n    return `${this.apiOptions.server}${path}?${q.join(\"&\")}`;\n  }\n\n  private forSomething<T>(path: string, callback: Callback<T>) {\n    const url = this.getUrl(path);\n\n    axios.get(url, {headers: this.apiOptions.headers})\n        .then((response) => {\n          return response.data as T;\n        })\n        .then((result) => {\n          if (callback) {\n            callback(null, result);\n          }\n        })\n        .catch((e) => {\n          if (callback) {\n            callback(e);\n          }\n        });\n  }\n}\n\nexport {\n  SearchBuilderImpl,\n};\n"]}