{"version":3,"sources":["../src/im.ts"],"names":[],"mappings":";AACA,sBAAwB,oBAAoB,CAAC,CAAA;AAC7C,sBAAwB,oBAAoB,CAAC,CAAA;AAC7C,0BAAmC,4BAA4B,CAAC,CAAA;AAChE,uBAAyB,gBAAgB,CAAC,CAAA;AAkC1C;IAKE,mBAAY,OAAqB;QAC/B,EAAE,CAAC,CAAC,CAAC,OAAO,IAAI,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC;YAC7C,MAAM,IAAI,KAAK,CAAC,sBAAoB,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,MAAG,CAAC,CAAC;QAClE,CAAC;QACD,IAAI,MAAc,CAAC;QACnB,IAAM,QAAQ,GAAW,OAAO,CAAC,OAAO,GAAG,SAAS,GAAG,UAAU,CAAC;QAClE,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,IAAI,IAAI,CAAC,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;YAC/C,KAAK,IAAI;gBACP,MAAM,GAAG,gBAAgB,CAAC;gBAC1B,KAAK,CAAC;YACR,KAAK,IAAI;gBACP,MAAM,GAAG,eAAe,CAAC;gBACzB,KAAK,CAAC;YACR,KAAK,MAAM;gBACT,MAAM,GAAG,kBAAkB,CAAC;gBAC5B,KAAK,CAAC;YACR;gBACE,MAAM,IAAI,KAAK,CAAC,oBAAkB,OAAO,CAAC,MAAM,MAAG,CAAC,CAAC;QACzD,CAAC;QACD,IAAI,CAAC,cAAc,GAAG,IAAI,mBAAU,CAAC,KAAG,QAAQ,GAAG,MAAQ,EAAE,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC;QACvF,IAAI,CAAC,YAAY,GAAG,IAAI,iBAAS,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;IACzD,CAAC;IAEM,yBAAK,GAAZ;QACE,MAAM,CAAC,IAAI,iBAAS,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;IAC5C,CAAC;IAEM,6BAAS,GAAhB,UAAiB,EAAW;QAC1B,MAAM,CAAC,IAAI,gCAAoB,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,CAAC,CAAC;IAC3D,CAAC;IAEM,yBAAK,GAAZ;QACE,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC;IAC3B,CAAC;IACH,gBAAC;AAAD,CAvCA,AAuCC,IAAA;AAED,EAAE,CAAC,CAAC,OAAO,MAAM,KAAK,WAAW,CAAC,CAAC,CAAC;IAClC,IAAM,EAAE,GAAG,IAAI,CAAC;IAChB,IAAM,EAAE,GAAG,IAAI,CAAC;IAChB,EAAE,CAAC,CAAC,OAAO,MAAM,CAAC,EAAE,CAAC,KAAK,WAAW,CAAC,CAAC,CAAC;QACtC,MAAM,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC;IAClB,CAAC;IACD,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,GAAG,UAAC,OAAqB;QACrC,MAAM,CAAC,IAAI,SAAS,CAAC,OAAO,CAAC,CAAC;IAChC,CAAC,CAAC;AACJ,CAAC;AAED,iBAAS,UAAC,OAAqB,IAAY,OAAA,IAAI,SAAS,CAAC,OAAO,CAAC,EAAtB,CAAsB,CAAC","file":"im.js","sourcesContent":["import {Login} from \"./api/login\";\nimport {AdminImpl} from \"./impl/admin/admin\";\nimport {LoginImpl} from \"./impl/login/login\";\nimport {PassengerBuilderImpl} from \"./impl/passenger/passenger\";\nimport {APIOptions} from \"./model/models\";\nimport {Admin} from \"./api/admin\";\nimport {PassengerBuilder} from \"./api/passenger\";\n\ninterface MaxIMOptions {\n  app: string;\n  key: string;\n  region?: string;\n  useHttp?: boolean;\n}\n\n/**\n * 主功能接口\n */\ninterface MaxIM {\n  /**\n   * 登录\n   * @return {Login}\n   */\n  login(): Login;\n\n  /**\n   * 访客登录\n   * @param id 访客ID\n   */\n  passenger(id?: string): PassengerBuilder;\n\n  /**\n   * 获取管理接口\n   * @return {Admin}\n   */\n  admin(): Admin;\n}\n\nclass MaxIMImpl implements MaxIM {\n\n  private currentOptions: APIOptions;\n  private currentAdmin: Admin;\n\n  constructor(options: MaxIMOptions) {\n    if (!options || !options.app || !options.key) {\n      throw new Error(`invalid options: ${JSON.stringify(options)}.`);\n    }\n    let server: string;\n    const protocol: string = options.useHttp ? \"http://\" : \"https://\";\n    switch ((options.region || \"cn\").toLowerCase()) {\n      case \"us\":\n        server = \"im.maxleap.com\";\n        break;\n      case \"cn\":\n        server = \"im.maxleap.cn\";\n        break;\n      case \"test\":\n        server = \"imuat.maxleap.cn\";\n        break;\n      default:\n        throw new Error(`invalid region ${options.region}.`);\n    }\n    this.currentOptions = new APIOptions(`${protocol}${server}`, options.app, options.key);\n    this.currentAdmin = new AdminImpl(this.currentOptions);\n  }\n\n  public login(): Login {\n    return new LoginImpl(this.currentOptions);\n  }\n\n  public passenger(id?: string): PassengerBuilder {\n    return new PassengerBuilderImpl(this.currentOptions, id);\n  }\n\n  public admin(): Admin {\n    return this.currentAdmin;\n  }\n}\n\nif (typeof window !== \"undefined\") {\n  const ml = \"ML\";\n  const im = \"im\";\n  if (typeof window[ml] === \"undefined\") {\n    window[ml] = {};\n  }\n  window[ml][im] = (options: MaxIMOptions) => {\n    return new MaxIMImpl(options);\n  };\n}\n\nexport = (options: MaxIMOptions): MaxIM => new MaxIMImpl(options);\n"]}