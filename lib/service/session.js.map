{"version":3,"sources":["../src/service/session.ts"],"names":[],"mappings":"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","file":"session.js","sourcesContent":["import {\n    Media,\n    MessageTo,\n    PushSettings,\n    Receiver,\n    MessageFrom,\n    YourselfMessageFrom,\n    SystemMessageFrom,\n    BasicMessageFrom\n} from \"../model/messages\";\nimport {Context, ContextImpl} from \"./context\";\nimport {APIOptions, Handler2, Handler3, Handler1, Callback, Callback2, LoginResult} from \"../model/models\";\nimport {convert2basic} from \"../helper/utils\";\nimport io = require('socket.io-client');\nimport Socket = SocketIOClient.Socket;\n\ninterface MessageBuilder {\n    asText(): MessageBuilder;\n    asImage(): MessageBuilder;\n    asAudio(): MessageBuilder;\n    asVideo(): MessageBuilder;\n\n    disablePush(): MessageBuilder;\n    setPushSound(sound: string): MessageBuilder;\n    setPushBadge(badge: number): MessageBuilder;\n    setPushContentAvailable(contentAvailable: boolean): MessageBuilder;\n    setPushPrefix(prefix: string): MessageBuilder;\n    setPushSuffix(suffix: string): MessageBuilder;\n    setPushTextOverwrite(text: string): MessageBuilder;\n\n    toFriend(friend: string): MessageLauncher;\n    toGroup(groupid: string): MessageLauncher;\n    toRoom(roomid: string): MessageLauncher;\n    toPassenger(passengerid: string): MessageLauncher;\n    toStranger(strangerid: string): MessageLauncher;\n}\n\ninterface MessageLauncher {\n    ok(callback?: Callback<void>): Session;\n}\n\nclass MessageBuilderImpl implements MessageBuilder {\n\n    message: MessageTo;\n    session: SessionImpl;\n\n    constructor(session: SessionImpl, text: string, remark?: string) {\n        this.session = session;\n        this.message = {\n            to: {\n                id: null\n            },\n            content: {\n                media: Media.TEXT,\n                body: text\n            }\n        };\n        if (remark != null) {\n            this.message.remark = remark;\n        }\n    }\n\n    asText(): MessageBuilder {\n        this.message.content.media = Media.TEXT;\n        return this;\n    }\n\n    asImage(): MessageBuilder {\n        this.message.content.media = Media.IMAGE;\n        return this;\n    }\n\n    asAudio(): MessageBuilder {\n        this.message.content.media = Media.AUDIO;\n        return this;\n    }\n\n    asVideo(): MessageBuilder {\n        this.message.content.media = Media.VIDEO;\n        return this;\n    }\n\n    private createPushIfNotExist(): PushSettings {\n        if (!this.message.push) {\n            this.message.push = {};\n        }\n        return this.message.push;\n    }\n\n    disablePush(): MessageBuilder {\n        this.createPushIfNotExist().enable = false;\n        return this;\n    }\n\n    setPushSound(sound: string): MessageBuilder {\n        this.createPushIfNotExist().sound = sound;\n        return this;\n    }\n\n    setPushBadge(badge: number): MessageBuilder {\n        this.createPushIfNotExist().badge = badge;\n        return this;\n    }\n\n    setPushContentAvailable(contentAvailable: boolean): MessageBuilder {\n        this.createPushIfNotExist().contentAvailable = contentAvailable;\n        return this;\n    }\n\n    setPushPrefix(prefix: string): MessageBuilder {\n        this.createPushIfNotExist().prefix = prefix;\n        return this;\n    }\n\n    setPushSuffix(suffix: string): MessageBuilder {\n        this.createPushIfNotExist().suffix = suffix;\n        return this;\n    }\n\n    setPushTextOverwrite(text: string): MessageBuilder {\n        this.createPushIfNotExist().overwrite = text;\n        return this;\n    }\n\n    toFriend(friend: string): MessageLauncher {\n        this.message.to.id = friend;\n        this.message.to.type = Receiver.ACTOR;\n        return new MessageLauncherImpl(this.session, this.message);\n    }\n\n    toGroup(groupid: string): MessageLauncher {\n        this.message.to.id = groupid;\n        this.message.to.type = Receiver.GROUP;\n        return new MessageLauncherImpl(this.session, this.message);\n    }\n\n    toRoom(roomid: string): MessageLauncher {\n        this.message.to.id = roomid;\n        this.message.to.type = Receiver.ROOM;\n        return new MessageLauncherImpl(this.session, this.message);\n    }\n\n    toPassenger(passengerid: string): MessageLauncher {\n        this.message.to.id = passengerid;\n        this.message.to.type = Receiver.PASSENGER;\n        return new MessageLauncherImpl(this.session, this.message);\n    }\n\n    toStranger(strangerid: string): MessageLauncher {\n        this.message.to.id = strangerid;\n        this.message.to.type = Receiver.STRANGER;\n        return new MessageLauncherImpl(this.session, this.message);\n    }\n\n}\n\nclass MessageLauncherImpl implements MessageLauncher {\n\n    session: SessionImpl;\n    message: MessageTo;\n\n    constructor(session: SessionImpl, message: MessageTo) {\n        this.session = session;\n        this.message = message;\n    }\n\n    ok(callback?: Callback<void>): Session {\n        try {\n            this.session.socket.emit('say', this.message);\n            if (callback) {\n                callback(null, null);\n            }\n        } catch (e) {\n            if (callback) {\n                callback(e);\n            }\n        }\n        return this.session;\n    }\n}\n\nexport class SessionBuilderImpl implements SessionBuilder {\n\n    private friends: Handler2<string,BasicMessageFrom>[];\n    private groups: Handler3<string,string,BasicMessageFrom>[];\n    private rooms: Handler3<string,string,BasicMessageFrom>[];\n    private passengers: Handler2<string,BasicMessageFrom>[];\n    private strangers: Handler2<string,BasicMessageFrom>[];\n    private friendonlines: Handler1<string>[];\n    private friendofflines: Handler1<string>[];\n    private strangeronlineds: Handler1<string>[];\n    private strangerofflines: Handler1<string>[];\n    private systems: Handler1<SystemMessageFrom>[];\n    private yourselfs: Handler1<YourselfMessageFrom>[];\n\n    private apiOptions: APIOptions;\n    private authdata: {};\n\n    constructor(apiOptions: APIOptions, authdata: {}) {\n        this.apiOptions = apiOptions;\n        this.authdata = authdata;\n\n        this.friends = [];\n        this.groups = [];\n        this.rooms = [];\n        this.passengers = [];\n        this.strangers = [];\n\n        this.friendonlines = [];\n        this.friendofflines = [];\n        this.strangeronlineds = [];\n        this.strangerofflines = [];\n        this.systems = [];\n        this.yourselfs = [];\n    }\n\n    setNotifyAll(enable: boolean): SessionBuilder {\n        this.authdata['notifyAll'] = enable;\n        return this;\n    }\n\n    setInstallation(installation: string): SessionBuilder {\n        this.authdata['install'] = installation;\n        return this;\n    }\n\n    onFriendMessage(handler: Handler2<string,BasicMessageFrom>): SessionBuilder {\n        this.friends.push(handler);\n        return this;\n    }\n\n    onGroupMessage(handler: Handler3<string,string,MessageFrom>): SessionBuilder {\n        this.groups.push(handler);\n        return this;\n    }\n\n    onRoomMessage(handler: Handler3<string,string,MessageFrom>): SessionBuilder {\n        this.rooms.push(handler);\n        return this;\n    }\n\n    onPassengerMessage(handler: Handler2<string,MessageFrom>): SessionBuilder {\n        this.passengers.push(handler);\n        return this;\n    }\n\n    onStrangerMessage(handler: Handler2<string,MessageFrom>): SessionBuilder {\n        this.strangers.push(handler);\n        return this;\n    }\n\n    onFriendOnline(handler: Handler1<string>): SessionBuilder {\n        this.friendonlines.push(handler);\n        return this;\n    }\n\n    onFriendOffline(handler: Handler1<string>): SessionBuilder {\n        this.friendofflines.push(handler);\n        return this;\n    }\n\n    onStrangerOnline(handler: Handler1<string>): SessionBuilder {\n        this.strangeronlineds.push(handler);\n        return this;\n    }\n\n    onStrangerOffline(handler: Handler1<string>): SessionBuilder {\n        this.strangerofflines.push(handler);\n        return this;\n    }\n\n    onSystemMessage(handler: Handler1<SystemMessageFrom>): SessionBuilder {\n        this.systems.push(handler);\n        return this;\n    }\n\n    onYourself(handler: Handler1<YourselfMessageFrom>): SessionBuilder {\n        this.yourselfs.push(handler);\n        return this;\n    }\n\n\n    ok(callback: Callback2<Session,Context>) {\n        let url = `${this.apiOptions.server}/chat`;\n        let socket = io.connect(url, {\n            query: `auth=${JSON.stringify(this.authdata)}`,\n            transports: ['websocket']\n        });\n        socket.once('login', result => {\n            let foo = result as LoginResult;\n            if (foo.success) {\n                let session = new SessionImpl(socket, foo.id);\n                let ctx = new ContextImpl(this.apiOptions, result.id);\n                callback(null, session, ctx);\n            } else {\n                callback(new Error(`error: ${foo.error}`), null, null);\n            }\n        });\n\n        socket.on('message', income => {\n            let msg = income as MessageFrom;\n            let basicmsg = convert2basic(msg);\n            switch (msg.from.type) {\n                case Receiver.ACTOR:\n                    for (let handler of this.friends) {\n                        handler(msg.from.id, basicmsg);\n                    }\n                    break;\n                case Receiver.GROUP:\n                    for (let handler of this.groups) {\n                        handler(msg.from.gid, msg.from.id, basicmsg);\n                    }\n                    break;\n                case Receiver.ROOM:\n                    for (let handler of this.rooms) {\n                        handler(msg.from.gid, msg.from.id, basicmsg);\n                    }\n                    break;\n                case Receiver.PASSENGER:\n                    for (let handler of this.passengers) {\n                        handler(msg.from.id, basicmsg);\n                    }\n                    break;\n                case Receiver.STRANGER:\n                    for (let handler of this.strangers) {\n                        handler(msg.from.id, basicmsg);\n                    }\n                    break;\n                default:\n                    break;\n            }\n        });\n\n        socket.on('online', onlineid => {\n            for (let handler of this.friendonlines) {\n                handler(onlineid as string);\n            }\n        });\n\n        socket.on('offline', offlineid=> {\n            for (let handler of this.friendofflines) {\n                handler(offlineid as string);\n            }\n        });\n\n        socket.on('online_x', onlineid => {\n            for (let handler of this.strangeronlineds) {\n                handler(onlineid as string);\n            }\n        });\n\n        socket.on('offline_x', offlineid => {\n            for (let handler of this.strangerofflines) {\n                handler(offlineid as string);\n            }\n        });\n\n        socket.on('sys', income => {\n            let msg = income as BasicMessageFrom;\n            for (let handler of this.systems) {\n                handler(msg);\n            }\n        });\n\n        socket.on('yourself', income => {\n            let msg = income as YourselfMessageFrom;\n            for (let handler of this.yourselfs) {\n                handler(msg);\n            }\n        });\n    }\n}\n\nclass SessionImpl implements Session {\n    private closed: boolean;\n    private userid: string;\n\n    socket: Socket;\n\n    constructor(socket: Socket, userid: string) {\n        this.closed = false;\n        this.socket = socket;\n        this.userid = userid;\n    }\n\n    current(): string {\n        return this.userid;\n    }\n\n    say(text: string, remark?: string): MessageBuilder {\n        if (this.closed) {\n            throw new Error('session is closed.');\n        }\n        return new MessageBuilderImpl(this, text, remark);\n    }\n\n    close(callback?: Callback<void>): void {\n        if (this.closed) {\n            return;\n        }\n        this.closed = true;\n        this.socket.close();\n    }\n\n}\n\nexport interface Session {\n    current(): string;\n    say(text: string, remark?: string): MessageBuilder;\n    close(callback?: Callback<void>): void;\n}\n\nexport interface SessionBuilder {\n    setNotifyAll(enable: boolean): SessionBuilder;\n    setInstallation(installation: string): SessionBuilder;\n\n    onFriendMessage(handler: Handler2<string,BasicMessageFrom>): SessionBuilder;\n    onGroupMessage(handler: Handler3<string, string,BasicMessageFrom>): SessionBuilder;\n    onRoomMessage(handler: Handler3<string,string,BasicMessageFrom>): SessionBuilder;\n    onPassengerMessage(handler: Handler2<string,BasicMessageFrom>): SessionBuilder;\n    onStrangerMessage(handler: Handler2<string,BasicMessageFrom>): SessionBuilder;\n    onFriendOnline(handler: Handler1<string>): SessionBuilder;\n    onFriendOffline(handler: Handler1<string>): SessionBuilder;\n    onStrangerOnline(handler: Handler1<string>): SessionBuilder;\n    onStrangerOffline(handler: Handler1<string>): SessionBuilder;\n    onSystemMessage(handler: Handler1<SystemMessageFrom>): SessionBuilder;\n    onYourself(handler: Handler1<YourselfMessageFrom>): SessionBuilder;\n\n    ok(callback: Callback2<Session,Context>);\n}\n"]}